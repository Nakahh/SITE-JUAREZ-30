<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>üî• EMERGENCY RESET</title>
    <style>
      body {
        font-family: Arial;
        text-align: center;
        padding: 50px;
        background: #f00;
        color: white;
      }
      button {
        padding: 20px;
        font-size: 18px;
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <h1>üî• EMERGENCY SYSTEM RESET</h1>
    <p>This will completely reset your browser state for this application.</p>

    <button onclick="nuclearReset()">üî• NUCLEAR RESET</button>
    <button onclick="window.location.href = '/'">üè† Try Homepage</button>

    <div id="status"></div>

    <script>
      function log(msg) {
        document.getElementById("status").innerHTML += "<br>" + msg;
        console.log(msg);
      }

      async function nuclearReset() {
        log("üî• Starting nuclear reset...");

        try {
          // 1. Unregister ALL service workers
          if ("serviceWorker" in navigator) {
            const registrations =
              await navigator.serviceWorker.getRegistrations();
            for (let registration of registrations) {
              await registration.unregister();
              log("‚úÖ Service worker unregistered: " + registration.scope);
            }
          }

          // 2. Delete ALL caches
          if ("caches" in window) {
            const cacheNames = await caches.keys();
            for (let name of cacheNames) {
              await caches.delete(name);
              log("‚úÖ Cache deleted: " + name);
            }
          }

          // 3. Clear ALL storage
          localStorage.clear();
          sessionStorage.clear();
          log("‚úÖ Storage cleared");

          // 4. Clear cookies
          document.cookie.split(";").forEach(function (c) {
            document.cookie = c
              .replace(/^ +/, "")
              .replace(
                /=.*/,
                "=;expires=" + new Date().toUTCString() + ";path=/",
              );
          });
          log("‚úÖ Cookies cleared");

          // 5. Clear IndexedDB
          if ("indexedDB" in window) {
            try {
              const dbs = await indexedDB.databases();
              for (let db of dbs) {
                indexedDB.deleteDatabase(db.name);
                log("‚úÖ IndexedDB deleted: " + db.name);
              }
            } catch (e) {
              log("‚ö†Ô∏è IndexedDB clear error: " + e.message);
            }
          }

          log("üéâ NUCLEAR RESET COMPLETE!");
          log("Redirecting in 3 seconds...");

          setTimeout(() => {
            window.location.replace("/?reset=" + Date.now());
          }, 3000);
        } catch (error) {
          log("‚ùå Reset error: " + error.message);
        }
      }

      // Auto-start reset
      window.addEventListener("load", function () {
        setTimeout(nuclearReset, 1000);
      });
    </script>
  </body>
</html>
